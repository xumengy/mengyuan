webpackJsonp([10,24],{"+LkW":function(t,e,a){"use strict";e.b=function(t){return Object(i.a)({url:"/admin/admin/integral/rule/list",method:"get",params:t})},e.c=function(t){return Object(i.a)({url:"/admin/admin/integral/rule/type/list",method:"get",params:t})},e.d=function(t){return Object(i.a)({url:"/admin/admin/integral/rule/add",method:"POST",data:t})},e.e=function(t){return Object(i.a)({url:"/admin/admin/integral/rule/update",method:"put",data:t})},e.a=function(t){return Object(i.a)({url:"/admin/admin/integral/rule/delete/"+t,method:"delete"})};var i=a("vLgD")},"9hd3":function(t,e,a){var i=a("L+7P");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("rjj0")("0d0fc88b",i,!0)},"L+7P":function(t,e,a){(t.exports=a("FZ+f")(!1)).push([t.i,"\n.input_inline[data-v-2be16bf2]{\n  display: inline-block;\n  width: 100px;\n  margin: 0 10px;\n}\n.time[data-v-2be16bf2]{\n  width: 400px;\n}\n",""])},L5Ze:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("mvHQ"),n=a.n(i),l=a("+LkW"),r=a("s8Ph"),o={name:"RuleAdd",props:{dialogStatus:String,ruleType:Array},data:function(){return{dialogFormVisible:!1,goodstype:[],dataForm:{type:1,valueId:"",integral:"",conditionValue:"",valueIntegral:"",dataTime:[]},textMap:{update:"编辑",create:"添加"},rules:{valueId:[{required:!0,message:"商品类型不能为空",trigger:"blur"}],type:[{required:!0,message:"积分类型不能为空",trigger:"blur"}],dataTime:[{required:!0,message:"起止时间不能为空",trigger:"change"}]}}},created:function(){this.getlistCategory()},methods:{init:function(t){var e=this;this.dialogFormVisible=!0,this.$nextTick(function(){e.initFormData(t)})},initFormData:function(t){if(t)this.dataForm=this.changeFormData(t),this.$forceUpdate();else{this.dataForm={type:1,valueId:"",integral:"",conditionValue:"",valueIntegral:"",dataTime:[]}}},changeFormData:function(t){var e=JSON.parse(n()(t));return e.dataTime=[],e.startTime&&(e.dataTime[0]=e.startTime),e.endTime&&(e.dataTime[1]=e.endTime),e.valueId||(e.valueId=0),e},getlistCategory:function(){var t=this;Object(r.c)().then(function(e){var a=e.data;t.goodstype=a.data})},changeType:function(t){this.$refs.dataForm.clearValidate()},postAdd:function(t){var e=this;Object(l.d)(t).then(function(t){0===t.data.code&&(e.$parent.getList(),e.closeDailog())}).catch(function(t){e.$message({type:"warning",message:t.data.msg})})},putUpdate:function(t){var e=this;Object(l.e)(t).then(function(t){0===t.data.code&&(e.$parent.getList(),e.closeDailog())}).catch(function(t){e.$message({type:"warning",message:t.data.msg})})},createData:function(t){this.formValidate(t)},updateData:function(t){this.formValidate(t)},formValidate:function(t){var e=this;this.$refs.dataForm.validate(function(a){if(!a)return console.log("error submit!!"),!1;var i={type:e.dataForm.type,valueId:1===e.dataForm.type?0:e.dataForm.valueId,integral:2!==e.dataForm.type?e.dataForm.integral:0,conditionValue:""!==e.dataForm.conditionValue?e.dataForm.conditionValue:0,valueIntegral:""!==e.dataForm.valueIntegral?e.dataForm.valueIntegral:0,startTime:e.dataForm.dataTime[0],endTime:e.dataForm.dataTime[1],id:e.dataForm.id?e.dataForm.id:""};"update"===t&&e.putUpdate(i),"create"===t&&e.postAdd(i)})},closeDailog:function(){this.dialogFormVisible=!1;this.dataForm={type:1,valueId:"",integral:"",conditionValue:"",valueIntegral:"",dataTime:[]},this.$refs.dataForm.resetFields()}}},s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogFormVisible,width:"1000px"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-form",{ref:"dataForm",staticClass:"demo-ruleForm",staticStyle:{"margin-left":"50px"},attrs:{rules:t.rules,model:t.dataForm,"status-icon":"","label-position":"left","label-width":"100px"}},[a("el-form-item",{staticStyle:{width:"400px"},attrs:{label:"积分类型",prop:"type"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:t.changeType},model:{value:t.dataForm.type,callback:function(e){t.$set(t.dataForm,"type",e)},expression:"dataForm.type"}},t._l(t.ruleType,function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),2===t.dataForm.type?[a("el-form-item",{staticStyle:{width:"400px"},attrs:{label:"商品类型",prop:"valueId"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.dataForm.valueId,callback:function(e){t.$set(t.dataForm,"valueId",e)},expression:"dataForm.valueId"}},t._l(t.goodstype,function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.value}})}))],1)]:t._e(),t._v(" "),a("el-form-item",{staticStyle:{width:"500px"},attrs:{label:"起止时间",prop:"dataTime"}},[a("el-date-picker",{staticClass:"time",attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.dataForm.dataTime,callback:function(e){t.$set(t.dataForm,"dataTime",e)},expression:"dataForm.dataTime"}})],1),t._v(" "),2===t.dataForm.type?[a("el-form-item",{attrs:{label:"积分规则",prop:"valueIntegral",required:!0,rules:{required:!0,message:"积分不能为空",trigger:"blur"}}},[a("span",[t._v("购物满")]),a("el-input",{staticClass:"input_inline",model:{value:t.dataForm.conditionValue,callback:function(e){t.$set(t.dataForm,"conditionValue",e)},expression:"dataForm.conditionValue"}}),a("span",[t._v("可获得")]),a("el-input",{staticClass:"input_inline",model:{value:t.dataForm.valueIntegral,callback:function(e){t.$set(t.dataForm,"valueIntegral",e)},expression:"dataForm.valueIntegral"}}),a("span",[t._v("积分")])],1)]:t._e(),t._v(" "),2!==t.dataForm.type?[a("el-form-item",{attrs:{label:"积分规则",prop:"integral",required:!0,rules:[{required:!0,message:"积分不能为空",trigger:"blur"}]}},[a("span",[t._v("可获得")]),a("el-input",{staticClass:"input_inline",model:{value:t.dataForm.integral,callback:function(e){t.$set(t.dataForm,"integral",e)},expression:"dataForm.integral"}}),a("span",[t._v("积分")])],1)]:t._e()],2),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.closeDailog}},[t._v("取消")]),t._v(" "),"create"==t.dialogStatus?a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.createData("create")}}},[t._v("确定")]):a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.updateData("update")}}},[t._v("确定")])],1)],1)},staticRenderFns:[]};var d=a("VU/8")(o,s,!1,function(t){a("9hd3")},"data-v-2be16bf2",null);e.default=d.exports},"R/Cq":function(t,e,a){(t.exports=a("FZ+f")(!1)).push([t.i,"\n.action-btn-width[data-v-0826da90]{\r\n  width: 70px;\n}\r\n",""])},WBlf:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("Dd8w"),n=a.n(i),l=a("NYxO"),r=a("+LkW"),o=a("qsHl"),s=a("0xDb"),d=a("Pcuu"),u={name:"integralrule",components:{RuleAdd:a("L5Ze").default,ActionPermControl:d.a},computed:n()({},Object(l.b)(["id","name"])),data:function(){return{list:void 0,total:void 0,listLoading:!0,listQuery:{type:"",valueId:"",page:1,limit:20},dateTime:void 0,dialogFormVisible:!1,dialogVisible:!1,dialogStatus:"",textMap:"",downloadLoading:!1,couponStatus:["","未开始","进行中","已过期"],listCategory:[],typeList:[]}},created:function(){this.getList(),this.getlistCategory(),this.getTypeList()},methods:{getList:function(){var t=this;Object(r.b)(this.listQuery).then(function(e){var a=e.data.data;t.list=a.items,t.total=a.total,t.listLoading=!1}).catch(function(){t.list=[],t.total=0,t.listLoading=!1})},getlistCategory:function(){var t=this;Object(o.e)().then(function(e){var a=e.data;t.listCategory=a.data.categoryList})},getTypeList:function(){var t=this;Object(r.c)().then(function(e){var a=e.data.data;t.typeList=a})},filterType:function(t,e){return 2===t.type?t.valueIntegral:t.integral},limitType:function(t){return t.typeLimit?t.typeLimitCount:"无上限"},handleTypeChange:function(t){this.getList()},handleGoodsTypeChange:function(){this.getList()},handleFilter:function(){this.listQuery.page=1,this.listQuery=Object(s.a)(this.listQuery),this.getList()},handleSizeChange:function(t){this.listQuery.limit=t,this.getList()},handleCurrentChange:function(t){this.listQuery.page=t,this.getList()},handleDetail:function(t){var e=this;this.dialogVisible=!0,this.$nextTick(function(){e.$refs.CouponDetail.init()})},handleEdit:function(t){var e=this;this.dialogFormVisible=!0,this.textMap="update",this.$nextTick(function(){e.$refs.CouponAdd.init(t)})},handleDelete:function(t){var e=this;this.$confirm("此操作将永久删除该优惠券, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(r.a)(t.id).then(function(t){0===t.data.code?(e.$message({type:"success",message:"删除成功!"}),e.getList()):e.$message({type:"error",message:t.data.msg})})})},handleAdd:function(){var t=this;this.dialogFormVisible=!0,this.textMap="create",this.$nextTick(function(){t.$refs.CouponAdd.init()})}}},c={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container calendar-list-container"},[a("div",{staticClass:"filter-container"},[a("el-form",{attrs:{inline:!0,"label-position":"right"}},[a("el-form-item",{staticClass:"no-margin-bottom",attrs:{label:"积分类型"}},[a("el-select",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{placeholder:"请选择"},on:{change:t.handleTypeChange},model:{value:t.listQuery.type,callback:function(e){t.$set(t.listQuery,"type",e)},expression:"listQuery.type"}},[a("el-option",{attrs:{label:"全部",value:""}}),t._v(" "),t._l(t.typeList,function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.id}})})],2)],1),t._v(" "),a("el-form-item",{staticClass:"no-margin-bottom",attrs:{label:"商品类型"}},[a("el-select",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{placeholder:"请选择"},on:{change:t.handleGoodsTypeChange},model:{value:t.listQuery.valueId,callback:function(e){t.$set(t.listQuery,"valueId",e)},expression:"listQuery.valueId"}},[a("el-option",{attrs:{label:"全部",value:""}}),t._v(" "),t._l(t.listCategory,function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.value}})})],2)],1),t._v(" "),a("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.handleFilter}},[t._v("查找")]),t._v(" "),t.$checkPerm("create")?a("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-plus",loading:t.downloadLoading},on:{click:t.handleAdd}},[t._v("添加")]):t._e()],1)],1),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],attrs:{size:"small",data:t.list,"element-loading-text":"正在查询中。。。",border:"",fit:"","highlight-current-row":""}},[a("el-table-column",{attrs:{align:"center",label:"序号",prop:"id"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"积分类型",prop:"typeName"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"商品类型",prop:"categoryName"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(e.row.categoryName?e.row.categoryName:"——")+"\n      ")]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"获得积分数",prop:"type",formatter:t.filterType}}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"每日上限(次)",prop:"limit"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(t.limitType(e.row))+"\n      ")]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"开始时间",prop:"startTime"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"结束时间",prop:"endTime"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"状态",prop:"status"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(t.couponStatus[e.row.status])+"\n      ")]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"操作",width:"250","class-name":"small-padding fixed-width"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("action-perm-control",{attrs:{hasPerm:t.$checkPerm("update","delete")}},[a("el-button",{staticClass:"action-btn-width",attrs:{type:"primary",size:"mini"},on:{click:function(a){t.handleEdit(e.row)}}},[t._v("编辑")]),t._v(" "),t.$checkPerm("delete")?a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){t.handleDelete(e.row)}}},[t._v("删除")]):t._e()],1)]}}])})],1),t._v(" "),a("div",{staticClass:"pagination-container"},[a("el-pagination",{attrs:{background:"","current-page":t.listQuery.page,"page-sizes":[10,20,30,50],"page-size":t.listQuery.limit,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),t._v(" "),t.dialogFormVisible?a("rule-add",{ref:"CouponAdd",attrs:{dialogStatus:t.textMap,ruleType:t.typeList}}):t._e()],1)},staticRenderFns:[]};var m=a("VU/8")(u,c,!1,function(t){a("aHg8")},"data-v-0826da90",null);e.default=m.exports},aHg8:function(t,e,a){var i=a("R/Cq");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("rjj0")("75bab8c8",i,!0)}});