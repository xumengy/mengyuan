webpackJsonp([45],{"F+lf":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("woOf"),s=i.n(a),n=i("vLgD");function l(t){return Object(n.a)({url:"/admin/admin/issue/read?id="+t,method:"get"})}var r=i("Pcuu"),o=i("EX+S"),d={name:"Issue",components:{ActionPermControl:r.a},data:function(){return{list:null,downloadPath:"",token:"",total:null,listLoading:!0,listQuery:{page:1,limit:20,question:void 0,sort:"add_time",order:"desc"},dataForm:{id:void 0,question:"",answer:[]},dialogFormVisible:!1,detailDialogVisible:!1,issueContent:"",dialogStatus:"",textMap:{update:"编辑",create:"创建"},rules:{question:[{required:!0,message:"问题不能为空",trigger:"blur"}],answer:[{required:!0,message:"回复图片不能为空",trigger:"blur"}]},uploadPath:"",picList:[],showFileList:!0,downloadLoading:!1}},created:function(){this.getList(),this.setCdnPath()},methods:{getList:function(){var t,e=this;this.listLoading=!0,(t=this.listQuery,Object(n.a)({url:"/admin/admin/issue/list",method:"get",params:t})).then(function(t){e.list=t.data.data.items,e.total=t.data.data.total,e.listLoading=!1}).catch(function(){e.list=[],e.total=0,e.listLoading=!1})},setCdnPath:function(){var t=this;Object(o.a)().then(function(e){var i=e.data.data;t.downloadPath=i.url,t.uploadPath="https://up-z2.qiniup.com?token="+i.accessKey})},handlePreview:function(t){var e=this;this.detailDialogVisible=!0,l(t.id).then(function(t){0===t.data.code&&(e.issueContent=t.data.data.answer.split(","))})},uploadOverrun:function(){this.$message({type:"error",message:"上传文件个数超出限制!最多上传5张图片!"})},handleContentUrl:function(t){var e=this.downloadPath+"/"+t.key;this.dataForm.answer||(this.dataForm.answer=[]),this.showFileList=!0,this.dataForm.answer.push(e)},handleRemove:function(t,e){for(var i=this,a=0;a<this.dataForm.answer.length;a++){var s=void 0;s=void 0===t.response?t.url:this.downloadPath+"/"+t.response.key,this.dataForm.answer[a]===s&&(this.dataForm.answer.splice(a,1),this.$nextTick(function(){0===i.dataForm.answer.length&&(i.dataForm.answer=null)}))}},handleFilter:function(){this.listQuery.page=1,this.getList()},handleSizeChange:function(t){this.listQuery.limit=t,this.getList()},handleCurrentChange:function(t){this.listQuery.page=t,this.getList()},resetForm:function(){this.dataForm={id:void 0,question:"",answer:[]}},handleCreate:function(){var t=this;this.resetForm(),this.dialogStatus="create",this.dialogFormVisible=!0,this.dataForm.answer=null,this.picList=[],this.showFileList=!1,this.$nextTick(function(){t.$refs.dataForm.clearValidate()})},createData:function(){var t=this;this.dataForm.answer instanceof Array&&(this.dataForm.answer=this.dataForm.answer.join(",")),this.$refs.dataForm.validate(function(e){var i;e&&(i=t.dataForm,Object(n.a)({url:"/admin/admin/issue/create",method:"post",data:i})).then(function(e){t.getList(),t.dialogFormVisible=!1,t.$notify({title:"成功",message:"创建成功",type:"success",duration:2e3})})})},handleUpdate:function(t){var e=this;this.dataForm=s()({},t),this.dialogStatus="update",this.dialogFormVisible=!0,this.showFileList=!1,this.picList=[],l(t.id).then(function(t){e.showFileList=!0,0===t.data.code&&(e.dataForm.answer=t.data.data.answer.split(","),e.dataForm.answer.map(function(t){e.picList.push({url:t})}))}),this.$nextTick(function(){e.$refs.dataForm.clearValidate()})},updateData:function(){var t=this;this.dataForm.answer instanceof Array&&(this.dataForm.answer=this.dataForm.answer.join(",")),this.$refs.dataForm.validate(function(e){var i;e&&(i=t.dataForm,Object(n.a)({url:"/admin/admin/issue/update",method:"post",data:i})).then(function(){t.getList(),t.dialogFormVisible=!1,t.$notify({title:"成功",message:"更新成功",type:"success",duration:2e3})})})},handleDelete:function(t){var e=this;this.$confirm("此操作将永久删除该问题, 是否继续?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var i;(i=t.id,Object(n.a)({url:"/admin/admin/issue/delete/"+i,method:"delete"})).then(function(t){e.$notify({title:"成功",message:"删除成功",type:"success",duration:2e3}),e.getList()}).catch(function(t){e.$notify({title:"失败",message:t.data?t.data.msg:"删除失败",type:"error",duration:2e3})})}).catch(function(){e.$message({type:"info",message:"已取消删除"})})}}},c={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app-container calendar-list-container"},[i("div",{staticClass:"filter-container"},[i("el-form",{attrs:{inline:!0,"label-position":"right"}},[i("el-form-item",{attrs:{label:"问题ID"}},[i("el-input",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{clearable:"",placeholder:"请输入问题ID"},model:{value:t.listQuery.id,callback:function(e){t.$set(t.listQuery,"id",e)},expression:"listQuery.id"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"问题内容"}},[i("el-input",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{clearable:"",placeholder:"请输入问题内容"},model:{value:t.listQuery.question,callback:function(e){t.$set(t.listQuery,"question",e)},expression:"listQuery.question"}})],1),t._v(" "),i("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.handleFilter}},[t._v("查找")]),t._v(" "),t.$checkPerm("create")?i("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-edit"},on:{click:t.handleCreate}},[t._v("添加")]):t._e()],1)],1),t._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],attrs:{size:"small",data:t.list,"element-loading-text":"正在查询中。。。",border:"",fit:"","highlight-current-row":""}},[i("el-table-column",{attrs:{align:"center",width:"100px",label:"问题ID",prop:"id",sortable:""}}),t._v(" "),i("el-table-column",{attrs:{align:"center","min-width":"200px",label:"问题内容",prop:"question"}}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"操作",width:"250","class-name":"small-padding fixed-width"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("action-perm-control",{attrs:{hasPerm:t.$checkPerm("update","delete","view")}},[t.$checkPerm("view")?i("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(i){t.handlePreview(e.row)}}},[t._v("预览")]):t._e(),t._v(" "),t.$checkPerm("update")?i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(i){t.handleUpdate(e.row)}}},[t._v("编辑")]):t._e(),t._v(" "),t.$checkPerm("delete")?i("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(i){t.handleDelete(e.row)}}},[t._v("删除")]):t._e()],1)]}}])})],1),t._v(" "),i("div",{staticClass:"pagination-container"},[i("el-pagination",{attrs:{background:"","current-page":t.listQuery.page,"page-sizes":[10,20,30,50],"page-size":t.listQuery.limit,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),t._v(" "),i("el-dialog",{attrs:{title:"预览",visible:t.detailDialogVisible},on:{"update:visible":function(e){t.detailDialogVisible=e}}},[i("div",{staticClass:"edit-view"},t._l(t.issueContent,function(t,e){return i("img",{key:e,attrs:{src:t}})}))]),t._v(" "),i("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogFormVisible,width:"1000px"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[i("el-form",{ref:"dataForm",staticStyle:{"margin-left":"30px"},attrs:{rules:t.rules,model:t.dataForm,"status-icon":"","label-position":"left","label-width":"120px"}},[i("el-form-item",{staticStyle:{width:"400px"},attrs:{label:"问题",prop:"question"}},[i("el-input",{model:{value:t.dataForm.question,callback:function(e){t.$set(t.dataForm,"question",e)},expression:"dataForm.question"}})],1),t._v(" "),i("el-form-item",{staticStyle:{"margin-right":"30px"},attrs:{label:"回复图片",prop:"answer"}},[i("el-upload",{attrs:{action:t.uploadPath,limit:5,multiple:"",accept:".jpg,.jpeg,.png,.gif","list-type":"picture-card","show-file-list":t.showFileList,"file-list":t.picList,"on-exceed":t.uploadOverrun,"on-success":t.handleContentUrl,"on-remove":t.handleRemove}},[i("i",{staticClass:"el-icon-plus"})]),t._v(" "),i("span",{staticClass:"pic-notice"},[t._v("最多上传5张")])],1)],1),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取消")]),t._v(" "),"create"==t.dialogStatus?i("el-button",{attrs:{type:"primary"},on:{click:t.createData}},[t._v("确定")]):i("el-button",{attrs:{type:"primary"},on:{click:t.updateData}},[t._v("确定")])],1)],1)],1)},staticRenderFns:[]};var u=i("VU/8")(d,c,!1,function(t){i("xir7")},null,null);e.default=u.exports},GNDF:function(t,e,i){(t.exports=i("FZ+f")(!1)).push([t.i,"\n.edit-view img{\r\n  width: 100%;\r\n  display: block;\n}\n.edit-view{\r\n  white-space: normal;\r\n  word-break: break-all;\n}\r\n",""])},xir7:function(t,e,i){var a=i("GNDF");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);i("rjj0")("7613a55e",a,!0)}});