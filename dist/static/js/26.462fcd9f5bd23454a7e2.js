webpackJsonp([26],{"1Tkg":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("mvHQ"),i=a.n(o),n=a("4cjj"),r=a("s8Ph"),l=a("/Zk0"),s={name:"CouponAdd",props:{dialogStatus:String},components:{BaseUploadSingle:l.a},data:function(){return{downloadPath:"",token:"",dialogFormVisible:!1,goodstype:[],coupontype:"",goodsno:"",dataForm:{id:void 0,name:"",imgUrl:"",type:void 0,conditionValue:"",valueId:"",value:"",num:"",startTime:this.changeTime((new Date).getTime()),endTime:this.changeTime((new Date).getTime())},textMap:{update:"编辑",create:"添加优惠券"},rules:{startTime:[{required:!0,message:"开始日期不能为空",trigger:"change"}],endTime:[{required:!0,message:"结束日期不能为空",trigger:"change"}],name:[{required:!0,message:"优惠券名称不能为空",trigger:"blur"}],type:[{required:!0,message:"商品类型不能为空",trigger:"blur"}],conditionValue:[{required:!0,message:"满减规则不能为空",trigger:"blur"}],value:[{required:!0,message:"满减规则不能为空",trigger:"change"}],num:[{required:!0,message:"发放数量不能为空",trigger:"blur"}]}}},created:function(){this.getlistCategory()},mounted:function(){},methods:{init:function(t){var e=this;this.dialogFormVisible=!0,this.$nextTick(function(){e.initFormData(t),e.$refs.dataForm.clearValidate()})},initFormData:function(t){t?(this.dataForm=this.changeFormData(t),this.$forceUpdate()):(this.$refs.dataForm.resetFields(),this.coupontype="",this.dataForm.conditionValue="",this.goodsno=""),this.$refs.dataForm.clearValidate()},changeFormData:function(t){var e=JSON.parse(i()(t));return 1===e.type&&(this.coupontype="all"),2===e.type&&(this.coupontype=e.valueId),3===e.type&&(this.coupontype="one",this.goodsno=e.valueId),e},getlistCategory:function(){var t=this;Object(r.c)().then(function(e){var a=e.data;t.goodstype=a.data})},getToken:function(t,e){this.token=t,this.downloadPath=e},add0:function(t){return t<10?"0"+t:t},changeTime:function(t){var e=new Date(t),a=e.getFullYear(),o=e.getMonth()+1,i=e.getDate();return a+"-"+this.add0(o)+"-"+this.add0(i)+" 00:00:00"},postCouponAdd:function(t){var e=this;Object(n.a)(t).then(function(t){0===t.data.code&&(e.dialogFormVisible=!1,e.$parent.getList())})},putCouponUpdate:function(t){var e=this;Object(n.c)(t).then(function(t){0===t.data.code&&(e.dialogFormVisible=!1,e.$parent.getList())})},createData:function(t){this.formValidate(t)},updateData:function(t){this.formValidate(t)},formValidate:function(t){var e=this;if("all"===this.coupontype)this.dataForm.type=1,this.dataForm.valueId=null;else if("one"===this.coupontype){if(this.dataForm.type=3,this.dataForm.valueId=this.goodsno,""===this.goodsno||null===this.goodsno)return void this.$message.error("商品Id不能为空")}else""!==this.coupontype&&(this.dataForm.type=2,this.dataForm.valueId=this.coupontype);this.$refs.dataForm.validate(function(a){if(!a)return console.log("error submit!!"),!1;var o=e.dataForm;return Number(o.conditionValue)<=Number(o.value)?(e.$message.error("满减不能小于优惠价格"),e.dataForm.conditionValue="",e.dataForm.value="",void e.$refs.dataForm.validateField("value")):new Date(Date.parse(e.dataForm.startTime))>new Date(Date.parse(e.dataForm.endTime))?(e.$message.error("开始时间不能大于结束时间"),e.$refs.dataForm.clearValidate("startTime"),void e.$refs.dataForm.clearValidate("endTime")):("update"===t&&e.putCouponUpdate(o),void("create"===t&&e.postCouponAdd(o)))})},uploadUrl:function(t){this.dataForm.imgUrl=t}}},d={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogFormVisible,width:"1000px"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-form",{ref:"dataForm",staticClass:"demo-ruleForm",staticStyle:{"margin-left":"50px"},attrs:{rules:t.rules,model:t.dataForm,"status-icon":"","label-position":"left","label-width":"100px"}},[a("el-form-item",{staticStyle:{width:"400px"},attrs:{label:"优惠券名称",prop:"name"}},[a("el-input",{model:{value:t.dataForm.name,callback:function(e){t.$set(t.dataForm,"name",e)},expression:"dataForm.name"}})],1),t._v(" "),a("el-form-item",{staticStyle:{width:"400px"},attrs:{label:"商品类型",prop:"type"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.coupontype,callback:function(e){t.coupontype=e},expression:"coupontype"}},[a("el-option",{attrs:{label:"全部商品",value:"all"}}),t._v(" "),t._l(t.goodstype,function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.value}})}),t._v(" "),a("el-option",{attrs:{label:"单品",value:"one"}})],2)],1),t._v(" "),"one"===t.coupontype?a("el-form-item",{staticStyle:{width:"400px"},attrs:{label:"商品Id",rules:{required:!0,message:"商品Id不能为空",trigger:"blur"}}},[a("el-input",{model:{value:t.goodsno,callback:function(e){t.goodsno=e},expression:"goodsno"}})],1):t._e(),t._v(" "),a("el-form-item",{staticStyle:{width:"400px"},attrs:{label:"开始日期",prop:"startTime"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.dataForm.startTime,callback:function(e){t.$set(t.dataForm,"startTime",e)},expression:"dataForm.startTime"}})],1),t._v(" "),a("el-form-item",{staticStyle:{width:"400px"},attrs:{label:"结束日期",prop:"endTime"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.dataForm.endTime,callback:function(e){t.$set(t.dataForm,"endTime",e)},expression:"dataForm.endTime"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"优惠券图片",prop:"imgUrl"}},[a("base-upload-single",{attrs:{url:t.dataForm.imgUrl},on:{onSuccess:t.uploadUrl,getToken:t.getToken}}),t._v(" "),a("span",{staticClass:"pic-notice"},[a("div",[t._v("建议上传303*96尺寸图片")])])],1),t._v(" "),a("el-form-item",{staticStyle:{width:"400px"},attrs:{label:"发放数量",prop:"num"}},[a("el-input",{staticClass:"input_inline",model:{value:t.dataForm.num,callback:function(e){t.$set(t.dataForm,"num",e)},expression:"dataForm.num"}}),a("span",[t._v("张")])],1),t._v(" "),a("el-form-item",{attrs:{label:"减免规则",prop:"value"}},[a("span",[t._v("购物满")]),a("el-input",{staticClass:"input_inline",attrs:{type:"number",min:"0"},model:{value:t.dataForm.conditionValue,callback:function(e){t.$set(t.dataForm,"conditionValue",e)},expression:"dataForm.conditionValue"}}),a("span",[t._v("元 ")]),a("span",[t._v("减免")]),a("el-input",{staticClass:"input_inline",attrs:{type:"number",min:"0"},model:{value:t.dataForm.value,callback:function(e){t.$set(t.dataForm,"value",e)},expression:"dataForm.value"}}),a("span",[t._v("元")])],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取消")]),t._v(" "),"create"==t.dialogStatus?a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.createData("create")}}},[t._v("确定")]):a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.updateData("update")}}},[t._v("确定")])],1)],1)},staticRenderFns:[]};var u=a("VU/8")(s,d,!1,function(t){a("7NBC")},"data-v-cd77bc60",null);e.default=u.exports},"4cjj":function(t,e,a){"use strict";e.d=function(t){return Object(o.a)({url:"/activity/activity/coupon/admin/getList",method:"get",params:t})},e.a=function(t){return Object(o.a)({url:"/activity/activity/coupon/admin/add",method:"POST",data:t})},e.c=function(t){return Object(o.a)({url:"/activity/activity/coupon/admin/update",method:"PUT",data:t})},e.b=function(t){return Object(o.a)({url:"/activity/activity/coupon/admin/delete/"+t,method:"PUT"})};var o=a("vLgD")},"7NBC":function(t,e,a){var o=a("HSgN");"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);a("rjj0")("169c8f0c",o,!0)},HSgN:function(t,e,a){(t.exports=a("FZ+f")(!1)).push([t.i,"\n.input_inline[data-v-cd77bc60]{\n  display: inline-block;\n  width: 120px;\n  margin: 0 10px;\n}\n",""])}});