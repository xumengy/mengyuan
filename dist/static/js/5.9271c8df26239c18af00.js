webpackJsonp([5,37,42],{"+uzR":function(t,e,o){var i=o("TyY/");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);o("rjj0")("34d75d0e",i,!0)},"00kX":function(t,e,o){var i=o("ETHG");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);o("rjj0")("1f850c6e",i,!0)},"8sds":function(t,e,o){(t.exports=o("FZ+f")(!1)).push([t.i,"\n.required-prefix[data-v-3c413e24]:before{\r\n  content: '*';\r\n  color: #f56c6c;\r\n  margin-right: 5px;\n}\r\n",""])},ETHG:function(t,e,o){(t.exports=o("FZ+f")(!1)).push([t.i,"\n.pic-notice[data-v-467540ea]{\r\n  display: inline-block;\r\n  vertical-align: top;\r\n  margin-top: -5px;\n}\r\n",""])},P4P9:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o("qsHl"),r=o("EX+S"),s=o("07y0"),n=o("zL8q"),a=o("Mg5x"),l=o("sLIJ"),c=o("bcC2"),d=o("apHD"),u=o.n(d),p=(o("m3AJ"),{name:"GoodsEdit",components:{SpecAndProduct:l.default,Attribute:c.default},data:function(){return{uploadPath:"",downloadPath:"",token:"",newKeywordVisible:!1,newCommentwordVisible:!1,newKeyword:"",newCommentword:"",keywords:[],userCommentKeywords:[],galleryFileList:[],detailFileList:[],categoryList:[],categoryIds:[],goods:{gallery:[]},goodsAddress:{cityId:"",goodsId:this.$route.query.id,provinceId:"",areaId:""},provinces:{},cities:{},areas:{},expressType:"",specifications:[{specification:"规格",value:"标准"}],products:[{id:0,specifications:["标准"],price:0,number:0,skuNo:0,url:""}],attributes:[],rules:a.c}},created:function(){this.init()},watch:{expressType:function(t){this.goods.expressType=t},"goods.gallery":function(t){this.setDragulaItemKeys()}},methods:{init:function(){var t=this;if(null!=this.$route.query.id){var e=this.$route.query.id;Object(i.c)(e).then(function(e){var o=e.data.data;t.goods=o.goods,t.keywords=o.goods.keywords?o.goods.keywords.split(","):[],t.userCommentKeywords=o.commentKeywordList?o.commentKeywordList:[],t.specifications=o.specifications,t.products=o.products,t.attributes=o.attributes,t.categoryIds=o.categoryIds,t.expressType=o.expressType,t.goods.expressType=t.expressType,t.initProvinceAndCity(o.goodsAddress.provinceId,o.goodsAddress.cityId,o.goodsAddress.areaId),t.galleryFileList=[],t.detailFileList=[];for(var i=0;i<t.goods.gallery.length;i++)t.galleryFileList.push({url:t.goods.gallery[i]});for(var r=t.goods.detail?t.goods.detail.split(","):[],s=0;s<r.length;s++)t.detailFileList.push({url:r[s]});t.$nextTick(function(){t.setDragulaItemKeys(),t.initDragula()})}),Object(i.e)().then(function(e){var o=e.data.data.categoryList;t.categoryList=o.map(function(t){return t.children&&0===t.children.length&&delete t.children,t})}),this.setCdnPath()}else n.MessageBox.alert("未提供商品id","禁止访问",{confirmButtonText:"确定",type:"error"}).finally(function(){t.$router.push({path:"/goods/list"})})},setCdnPath:function(){var t=this;Object(r.a)().then(function(e){var o=e.data.data;t.token=o.accessKey,t.uploadPath="https://up-z2.qiniup.com?token="+o.accessKey,t.downloadPath=o.url})},setDragulaItemKeys:function(){for(var t=document.querySelectorAll(".gallery-img-wrapper .el-upload-list__item"),e=0;e<t.length;e++){t[e].setAttribute("img",this.goods.gallery[e])}},getDragulaItemKeys:function(){for(var t=[],e=document.querySelectorAll(".gallery-img-wrapper .el-upload-list__item"),o=0;o<e.length;o++){var i=e[o];t.push(i.getAttribute("img"))}return t},initDragula:function(){var t=this;u()([document.querySelector(".gallery-img-wrapper .el-upload-list--picture-card")]).on("drop",function(e){t.goods.gallery=t.getDragulaItemKeys()})},initProvinceAndCity:function(t,e,o){var i=this;t&&Object(s.b)({id:0}).then(function(r){i.provinces=r.data.data,i.goodsAddress.provinceId=t,e&&Object(s.b)({id:t}).then(function(t){i.cities=t.data.data,i.goodsAddress.cityId=e,o&&Object(s.b)({id:e}).then(function(t){i.areas=t.data.data,i.goodsAddress.areaId=o})})}),t||e||this.getProvinces()},getProvinces:function(){var t=this;Object(s.b)({id:0}).then(function(e){t.provinces=e.data.data})},provinceChange:function(t){var e=this;void 0!==t&&(this.cities={},this.goodsAddress.cityId=void 0,Object(s.b)({id:t}).then(function(t){e.cities=t.data.data}))},cityChange:function(t){var e=this;void 0!==t&&(this.areas={},this.goodsAddress.areaId=void 0,Object(s.b)({id:t}).then(function(t){e.areas=t.data.data}))},handleCategoryChange:function(t){(this.goods.categoryId=t,t)&&(1===this.categoryList.filter(function(e){return e.value===t})[0].type?this.expressType=!0:this.expressType=!1)},updateSpec:function(t){this.specifications=t},updateProduct:function(t){this.products=t},updateAttribute:function(t){this.attributes=t},handleCancel:function(){this.$router.push({path:"/goods/list"})},handleEdit:function(){var t=this;this.goods.retailPrice=Number(this.goods.retailPrice);var e={commentKeywords:this.userCommentKeywords,goods:this.goods,specifications:this.specifications,products:this.products,attributes:this.attributes,expressType:{goodsId:this.$route.query.id,expressType:this.goods.expressType},goodsAddress:this.goodsAddress};this.$refs.goods.validate(function(o){o?t.validateSpecAndProducts(t.specifications,t.products)&&Object(i.d)(e).then(function(e){t.$notify({title:"成功",message:"更新成功",type:"success",duration:2e3});var o=t.$route.query.page;t.$router.push({path:"/goods/list",query:{page:o}})}).catch(function(t){n.MessageBox.alert("业务错误："+t.data.msg,"警告",{confirmButtonText:"确定",type:"error"})}):t.$notify({title:"失败",message:"校验规则不通过，请检查输入是否有误",type:"error",duration:2e3})})},validateSpecAndProducts:function(t,e){return t.length&&0!==t.length?!(!e.length||0===e.length)||(this.$notify({title:"失败",type:"error",message:"商品库存不能为空"}),!1):(this.$notify({title:"失败",type:"error",message:"商品规格不能为空"}),!1)},handleClose:function(t){this.keywords.splice(this.keywords.indexOf(t),1),this.goods.keywords=this.keywords.toString()},handleCloseComment:function(t){this.userCommentKeywords.splice(this.userCommentKeywords.indexOf(t),1)},showInput:function(){var t=this;this.newKeywordVisible=!0,this.$nextTick(function(){t.$refs.newKeywordInput.$refs.input.focus()})},showInputComment:function(){var t=this;this.newCommentwordVisible=!0,this.$nextTick(function(){t.$refs.newCommentwordInput.$refs.input.focus()})},handleInputConfirm:function(){var t=this.newKeyword;t&&(this.keywords.push(t),this.goods.keywords=this.keywords.toString()),this.newKeywordVisible=!1,this.newKeyword=""},handleCommentInputConfirm:function(){var t=this.newCommentword;if(this.userCommentKeywords.length>=5)this.$message({type:"error",message:"评论标签最多只能添加5个！！！"});else if(t){var e={count:0,keywords:t};this.userCommentKeywords.push(e)}this.newCommentwordVisible=!1,this.newCommentword=""},uploadPicUrl:function(t){this.goods.picUrl=this.downloadPath+"/"+t.key},uploadGalleryOverrun:function(t,e){this.uploadOverrun(5)},uploadDetailOverrun:function(){this.uploadOverrun(10)},uploadOverrun:function(t){this.$message({type:"error",message:"上传文件个数超出限制!最多上传"+t+"张图片!"})},handleGalleryUrl:function(t,e,o){var i=this.downloadPath+"/"+t.key;this.goods.gallery.push(i)},handleDetailUrl:function(t,e,o){var i=this.downloadPath+"/"+t.key,r=this.goods.detail?this.goods.detail.split(","):[];r.push(i),this.goods.detail=r.join(",")},handleRemove:function(t,e){for(var o=0;o<this.goods.gallery.length;o++){var i=void 0;i=void 0===t.response?t.url:this.downloadPath+"/"+t.response.key,this.goods.gallery[o]===i&&this.goods.gallery.splice(o,1)}},handleDetailRemove:function(t,e){for(var o=this.goods.detail?this.goods.detail.split(","):[],i=0;i<o.length;i++){var r=void 0;r=void 0===t.response?t.url:this.downloadPath+"/"+t.response.key,o[i]===r&&(o.splice(i,1),this.goods.detail=o.join(","))}},specChanged:function(t){!1===t?(this.specifications=[{specification:"规格",value:"标准",picUrl:""}],this.products=[{id:0,specifications:["标准"],price:0,number:0,skuNo:0,url:""}]):(this.specifications=[],this.products=[])}}}),f={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"app-container calendar-list-container"},[o("el-card",{staticClass:"box-card"},[o("h3",[t._v("商品介绍")]),t._v(" "),o("el-form",{ref:"goods",attrs:{rules:t.rules,model:t.goods,"label-width":"150px"}},[o("el-form-item",{attrs:{label:"商品名称",prop:"name"}},[o("el-input",{model:{value:t.goods.name,callback:function(e){t.$set(t.goods,"name",e)},expression:"goods.name"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"商品简介"}},[o("el-input",{model:{value:t.goods.brief,callback:function(e){t.$set(t.goods,"brief",e)},expression:"goods.brief"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"原价",prop:"counterPrice"}},[o("el-input",{attrs:{type:"number",placeholder:"0.00"},model:{value:t.goods.counterPrice,callback:function(e){t.$set(t.goods,"counterPrice",e)},expression:"goods.counterPrice"}},[o("template",{slot:"append"},[t._v("元")])],2)],1),t._v(" "),o("el-form-item",{attrs:{label:"当前价格",prop:"retailPrice"}},[o("el-input",{attrs:{placeholder:"0.00"},model:{value:t.goods.retailPrice,callback:function(e){t.$set(t.goods,"retailPrice",e)},expression:"goods.retailPrice"}},[o("template",{slot:"append"},[t._v("元")])],2)],1),t._v(" "),o("el-form-item",{attrs:{label:"是否推荐",prop:"isRecommend"}},[o("el-radio-group",{model:{value:t.goods.isRecommend,callback:function(e){t.$set(t.goods,"isRecommend",e)},expression:"goods.isRecommend"}},[o("el-radio",{attrs:{label:!0}},[t._v("推荐")]),t._v(" "),o("el-radio",{attrs:{label:!1}},[t._v("不推荐")])],1)],1),t._v(" "),o("el-form-item",{attrs:{label:"是否显示月销",prop:"showMonthSell"}},[o("el-radio-group",{model:{value:t.goods.showMonthSell,callback:function(e){t.$set(t.goods,"showMonthSell",e)},expression:"goods.showMonthSell"}},[o("el-radio",{attrs:{label:!0}},[t._v("显示")]),t._v(" "),o("el-radio",{attrs:{label:!1}},[t._v("不显示")])],1)],1),t._v(" "),o("el-form-item",{attrs:{label:"是否上架",prop:"isOnSale"}},[o("el-radio-group",{model:{value:t.goods.isOnSale,callback:function(e){t.$set(t.goods,"isOnSale",e)},expression:"goods.isOnSale"}},[o("el-radio",{attrs:{label:!0}},[t._v("上架")]),t._v(" "),o("el-radio",{attrs:{label:!1}},[t._v("下架")])],1)],1),t._v(" "),o("el-form-item",{attrs:{label:"商品产地"}},[o("el-select",{attrs:{placeholder:"省"},on:{change:t.provinceChange},model:{value:t.goodsAddress.provinceId,callback:function(e){t.$set(t.goodsAddress,"provinceId",e)},expression:"goodsAddress.provinceId"}},t._l(t.provinces,function(t){return o("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),t._v(" "),o("el-select",{attrs:{placeholder:"市"},on:{change:t.cityChange},model:{value:t.goodsAddress.cityId,callback:function(e){t.$set(t.goodsAddress,"cityId",e)},expression:"goodsAddress.cityId"}},t._l(t.cities,function(t){return o("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),t._v(" "),o("el-select",{attrs:{placeholder:"区"},model:{value:t.goodsAddress.areaId,callback:function(e){t.$set(t.goodsAddress,"areaId",e)},expression:"goodsAddress.areaId"}},t._l(t.areas,function(t){return o("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),o("el-form-item",{attrs:{label:"商品图片",prop:"picUrl"}},[o("el-upload",{staticClass:"avatar-uploader",attrs:{action:t.uploadPath,"list-type":"picture-card","show-file-list":!1,accept:".jpg,.jpeg,.png,.gif","on-success":t.uploadPicUrl}},[t.goods.picUrl?o("img",{staticClass:"avatar",attrs:{src:t.goods.picUrl}}):o("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),t._v(" "),o("el-form-item",{staticClass:"gallery-img-wrapper",attrs:{label:"宣传画廊"}},[o("el-upload",{attrs:{action:t.uploadPath,limit:5,multiple:"",accept:".jpg,.jpeg,.png,.gif","file-list":t.galleryFileList,"list-type":"picture-card","on-exceed":t.uploadGalleryOverrun,"on-success":t.handleGalleryUrl,"on-remove":t.handleRemove}},[o("i",{staticClass:"el-icon-plus"})]),t._v(" "),o("span",{staticClass:"pic-notice"},[t._v("建议上传375*375尺寸图片，商品图片最多上传1张，宣传画廊最多上传5张")])],1),t._v(" "),o("el-form-item",{attrs:{label:"商品单位",prop:"unit"}},[o("el-input",{attrs:{placeholder:"件 / 个 / 盒"},model:{value:t.goods.unit,callback:function(e){t.$set(t.goods,"unit",e)},expression:"goods.unit"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"商品重量",prop:"weight"}},[o("el-input",{attrs:{placeholder:"请输入"},model:{value:t.goods.weight,callback:function(e){t.$set(t.goods,"weight",e)},expression:"goods.weight"}},[o("template",{slot:"append"},[t._v("kg")])],2)],1),t._v(" "),o("el-form-item",{attrs:{label:"评价标签"}},[t._l(t.userCommentKeywords,function(e,i){return o("el-tag",{key:i,attrs:{closable:"",type:"primary"},on:{close:function(o){t.handleCloseComment(e)}}},[t._v("\r\n            "+t._s(e.keywords)+"\r\n          ")])}),t._v(" "),t.newCommentwordVisible?o("el-input",{ref:"newCommentwordInput",staticClass:"input-new-keyword",attrs:{maxlength:"20",size:"small"},on:{blur:t.handleCommentInputConfirm},nativeOn:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.handleCommentInputConfirm(e):null}},model:{value:t.newCommentword,callback:function(e){t.newCommentword=e},expression:"newCommentword"}}):o("el-button",{staticClass:"button-new-keyword",attrs:{size:"small",type:"primary"},on:{click:t.showInputComment}},[t._v("+ 增加")])],2),t._v(" "),o("el-form-item",{attrs:{label:"搜索关键字"}},[t._l(t.keywords,function(e){return o("el-tag",{key:e,attrs:{closable:"",type:"primary"},on:{close:function(o){t.handleClose(e)}}},[t._v("\r\n            "+t._s(e)+"\r\n          ")])}),t._v(" "),t.newKeywordVisible?o("el-input",{ref:"newKeywordInput",staticClass:"input-new-keyword",attrs:{size:"small"},on:{blur:t.handleInputConfirm},nativeOn:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.handleInputConfirm(e):null}},model:{value:t.newKeyword,callback:function(e){t.newKeyword=e},expression:"newKeyword"}}):o("el-button",{staticClass:"button-new-keyword",attrs:{size:"small",type:"primary"},on:{click:t.showInput}},[t._v("+ 增加")])],2),t._v(" "),o("el-form-item",{attrs:{label:"所属分类",prop:"categoryId"}},[o("el-select",{attrs:{placeholder:"请选择"},on:{change:t.handleCategoryChange},model:{value:t.goods.categoryId,callback:function(e){t.$set(t.goods,"categoryId",e)},expression:"goods.categoryId"}},t._l(t.categoryList,function(t){return o("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),o("el-form-item",{attrs:{label:"配送方式",prop:"expressType"}},[o("el-tag",[t._v(t._s(t.expressType?"上门自提":"物流快递"))])],1),t._v(" "),o("el-form-item",{attrs:{label:"商品详细介绍",prop:"detail"}},[o("el-upload",{attrs:{action:t.uploadPath,limit:10,multiple:"",accept:".jpg,.jpeg,.png,.gif","file-list":t.detailFileList,"list-type":"picture-card","on-exceed":t.uploadDetailOverrun,"on-success":t.handleDetailUrl,"on-remove":t.handleDetailRemove}},[o("i",{staticClass:"el-icon-plus"})]),t._v(" "),o("span",{staticClass:"pic-notice"},[t._v("图片最多上传10张")])],1)],1)],1),t._v(" "),o("spec-and-product",{attrs:{uploadPath:t.uploadPath,downloadPath:t.downloadPath,token:t.token,specInfo:t.specifications,proInfo:t.products},on:{"update-spec":t.updateSpec,"update-product":t.updateProduct}}),t._v(" "),o("attribute",{attrs:{attr:t.attributes},on:{"update-attribute":t.updateAttribute}}),t._v(" "),o("div",{staticClass:"op-container"},[o("el-button",{on:{click:t.handleCancel}},[t._v("取消")]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:t.handleEdit}},[t._v("更新商品")])],1)],1)},staticRenderFns:[]};var h=o("VU/8")(p,f,!1,function(t){o("+uzR"),o("00kX")},"data-v-467540ea",null);e.default=h.exports},"TyY/":function(t,e,o){(t.exports=o("FZ+f")(!1)).push([t.i,"\n.el-card {\n    margin-bottom: 10px;\n}\n.el-tag + .el-tag {\n    margin-left: 10px;\n}\n.input-new-keyword {\n    width: 120px;\n    margin-left: 10px;\n    vertical-align: bottom;\n}\n.avatar-uploader .el-upload {\n\t  border: 1px dashed #d9d9d9;\n\t  border-radius: 6px;\n\t  cursor: pointer;\n\t  position: relative;\n\t  overflow: hidden;\n}\n.avatar-uploader .el-upload:hover {\n\t  border-color: #20a0ff;\n}\n.avatar-uploader-icon {\n    font-size: 28px;\n    color: #8c939d;\n    width: 146px;\n    height: 146px;\n    line-height: 146px;\n    text-align: center;\n}\n.avatar {\n    width: 146px;\n    height: 146px;\n    display: block;\n}\n.gallery-img-wrapper .el-upload-list--picture-card img, .gu-mirror img{\n    width: 146px;\n    height: 146px;\n}\n.gu-mirror.el-upload-list__item{\n    overflow: hidden;\n    background-color: #fff;\n    border: 1px solid #c0ccda;\n    border-radius: 6px;\n    -webkit-box-sizing: border-box;\n    box-sizing: border-box;\n    width: 146px;\n    height: 146px;\n    margin: 0 8px 8px 0;\n    display: inline-block;\n}\n",""])},bcC2:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o("Mg5x"),r={name:"Attribute",props:{attr:Array},data:function(){return{attributeVisiable:!1,attributeForm:{attribute:"",value:""},attributes:[],attributeRules:i.a}},watch:{attr:function(t){this.attributes=t},attributes:function(t){this.$emit("update-attribute",t)}},methods:{handleAttributeShow:function(){var t=this;this.attributeForm={},this.attributeVisiable=!0,this.$nextTick(function(){t.$refs.attributeForm.clearValidate()})},handleAttributeAdd:function(){var t=this;this.$refs.attributeForm.validate(function(e){e&&(t.attributes.push(t.attributeForm),t.attributeVisiable=!1)})},handleAttributeDelete:function(t){var e=this.attributes.indexOf(t);this.attributes.splice(e,1)}}},s={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-card",{staticClass:"box-card"},[o("h3",[t._v("商品参数")]),t._v(" "),o("el-button",{attrs:{plain:!0,type:"primary"},on:{click:t.handleAttributeShow}},[t._v("添加")]),t._v(" "),o("el-table",{attrs:{data:t.attributes}},[o("el-table-column",{attrs:{property:"attribute",label:"商品参数名称"}}),t._v(" "),o("el-table-column",{attrs:{property:"value",label:"商品参数值"}}),t._v(" "),o("el-table-column",{attrs:{align:"center",label:"操作",width:"100","class-name":"small-padding fixed-width"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(o){t.handleAttributeDelete(e.row)}}},[t._v("删除")])]}}])})],1),t._v(" "),o("el-dialog",{attrs:{title:"设置商品参数",visible:t.attributeVisiable},on:{"update:visible":function(e){t.attributeVisiable=e}}},[o("el-form",{ref:"attributeForm",staticStyle:{width:"400px","margin-left":"50px"},attrs:{rules:t.attributeRules,model:t.attributeForm,"status-icon":"","label-position":"left","label-width":"120px"}},[o("el-form-item",{attrs:{label:"商品参数名称",prop:"attribute"}},[o("el-input",{model:{value:t.attributeForm.attribute,callback:function(e){t.$set(t.attributeForm,"attribute",e)},expression:"attributeForm.attribute"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"商品参数值",prop:"value"}},[o("el-input",{model:{value:t.attributeForm.value,callback:function(e){t.$set(t.attributeForm,"value",e)},expression:"attributeForm.value"}})],1)],1),t._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(e){t.attributeVisiable=!1}}},[t._v("取消")]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:t.handleAttributeAdd}},[t._v("确定")])],1)],1)],1)},staticRenderFns:[]};var n=o("VU/8")(r,s,!1,function(t){o("wG0u")},null,null);e.default=n.exports},ddzh:function(t,e,o){(t.exports=o("FZ+f")(!1)).push([t.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",""])},fgCa:function(t,e,o){var i=o("8sds");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);o("rjj0")("3e8feb57",i,!0)},sLIJ:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o("mvHQ"),r=o.n(i),s=o("Mg5x"),n={name:"SpecAndProduct",props:{uploadPath:String,downloadPath:String,token:String,specInfo:Array,proInfo:Array},data:function(){return{specRules:s.e,productRules:s.d,specifications:this.spec,specForm:{specification:"",value:""},specVisiable:!1,products:this.pro,productForm:{id:0,specifications:[],price:0,number:0,url:""},productVisiable:!1}},watch:{specInfo:function(t){this.specifications=t},proInfo:function(t){this.products=t},specifications:function(t){this.$emit("update-spec",t)},products:function(t){this.$emit("update-product",t)}},methods:{uploadProductUrl:function(t){this.productForm.url=this.downloadPath+"/"+t.key},handleSpecificationShow:function(){var t=this;this.specForm={specification:"",value:""},this.specVisiable=!0,this.$nextTick(function(){t.$refs.specForm.clearValidate()})},handleSpecificationAdd:function(){var t=this;this.$refs.specForm.validate(function(e){if(e){for(var o=t.specifications.length-1,i=0;i<t.specifications.length;i++){t.specifications[i].specification===t.specForm.specification&&(o=i)}t.specifications.splice(o+1,0,t.specForm),t.specVisiable=!1,t.specToProduct()}})},handleSpecificationDelete:function(t){var e=this.specifications.indexOf(t);this.specifications.splice(e,1),this.specToProduct()},specToProduct:function(){if(0!==this.specifications.length){var t=[],e=this.specifications[0].specification,o=[];o.push(0);for(var i=1;i<this.specifications.length;i++){var r=this.specifications[i].specification;r===e?o.push(i):(t.push(o),e=r,(o=[]).push(i))}t.push(o);for(var s=0,n=[],a=[],l=t.length,c=0;c<l;c++)a[c]=0;var d=0,u=!1;do{for(var p=[],f=this.products[s]?this.products[s].id:null,h=0;h<l;h++){var m=t[h][a[h]];p.push(this.specifications[m].value)}n[s]={id:f,key:s,specifications:p,price:0,skuNo:0,number:0,url:""},s++,d++,a[l-1]=d;for(var v=l-1;v>=0;v--)a[v]>=t[v].length&&(a[v]=0,d=0,v-1>=0&&(a[v-1]=a[v-1]+1));u=!1;for(var g=0;g<l;g++)0!==a[g]&&(u=!0)}while(u);this.products=n}else this.products=[]},handleProductShow:function(t){var e=this;this.productForm=JSON.parse(r()(t)),this.productVisiable=!0,this.$nextTick(function(){e.$refs.productForm.clearValidate()})},handleProductEdit:function(){var t=this;this.$refs.productForm.validate(function(e){if(e){for(var o=0;o<t.products.length;o++){var i=t.products[o];if(void 0!==i.id&&null!==i.id&&i.id===t.productForm.id){t.products.splice(o,1,t.productForm);break}if(void 0!==i.key&&null!==i.key&&i.key===t.productForm.key){t.products.splice(o,1,t.productForm);break}}t.productVisiable=!1}})}}},a={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("el-card",{staticClass:"box-card"},[o("h3",{staticClass:"required-prefix"},[t._v("商品规格")]),t._v(" "),o("el-button",{attrs:{plain:!0,type:"primary"},on:{click:t.handleSpecificationShow}},[t._v("添加")]),t._v(" "),o("el-table",{attrs:{data:t.specifications}},[o("el-table-column",{attrs:{property:"specification",label:"规格名"}}),t._v(" "),o("el-table-column",{attrs:{property:"value",label:"规格值"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-tag",{attrs:{type:"primary"}},[t._v("\r\n            "+t._s(e.row.value)+"\r\n          ")])]}}])}),t._v(" "),o("el-table-column",{attrs:{align:"center",label:"操作",width:"250","class-name":"small-padding fixed-width"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(o){t.handleSpecificationDelete(e.row)}}},[t._v("删除")])]}}])})],1),t._v(" "),o("el-dialog",{attrs:{title:"设置规格",visible:t.specVisiable},on:{"update:visible":function(e){t.specVisiable=e}}},[o("el-form",{ref:"specForm",staticStyle:{width:"400px","margin-left":"50px"},attrs:{rules:t.specRules,model:t.specForm,"status-icon":"","label-position":"left","label-width":"100px"}},[o("el-form-item",{attrs:{label:"规格名",prop:"specification"}},[o("el-input",{model:{value:t.specForm.specification,callback:function(e){t.$set(t.specForm,"specification",e)},expression:"specForm.specification"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"规格值",prop:"value"}},[o("el-input",{model:{value:t.specForm.value,callback:function(e){t.$set(t.specForm,"value",e)},expression:"specForm.value"}})],1)],1),t._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(e){t.specVisiable=!1}}},[t._v("取消")]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:t.handleSpecificationAdd}},[t._v("确定")])],1)],1)],1),t._v(" "),o("el-card",{staticClass:"box-card"},[o("h3",{staticClass:"required-prefix"},[t._v("商品库存")]),t._v(" "),o("el-table",{attrs:{data:t.products,"row-key":"key"}},[o("el-table-column",{attrs:{property:"value",label:"货品规格"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.specifications,function(e,i){return o("el-tag",{key:i},[t._v("\r\n            "+t._s(e)+"\r\n          ")])})}}])}),t._v(" "),o("el-table-column",{attrs:{property:"skuNo",width:"100",label:"SKU编码"}}),t._v(" "),o("el-table-column",{attrs:{property:"price",width:"100",label:"货品售价"}}),t._v(" "),o("el-table-column",{attrs:{property:"number",width:"100",label:"货品数量"}}),t._v(" "),o("el-table-column",{attrs:{property:"url",width:"100",label:"货品图片"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.url?o("img",{attrs:{src:e.row.url,width:"40"}}):t._e()]}}])}),t._v(" "),o("el-table-column",{attrs:{align:"center",label:"操作",width:"100","class-name":"small-padding fixed-width"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(o){t.handleProductShow(e.row)}}},[t._v("设置")])]}}])})],1),t._v(" "),o("el-dialog",{attrs:{title:"设置货品",visible:t.productVisiable},on:{"update:visible":function(e){t.productVisiable=e}}},[o("el-form",{ref:"productForm",staticStyle:{width:"400px","margin-left":"50px"},attrs:{rules:t.productRules,model:t.productForm,"status-icon":"","label-position":"left","label-width":"100px"}},[o("el-form-item",{attrs:{label:"货品规格列",prop:"specifications"}},t._l(t.productForm.specifications,function(e,i){return o("el-tag",{key:i},[t._v("\r\n            "+t._s(e)+"\r\n          ")])})),t._v(" "),o("el-form-item",{attrs:{label:"货品售价",prop:"price"}},[o("el-input",{model:{value:t.productForm.price,callback:function(e){t.$set(t.productForm,"price",e)},expression:"productForm.price"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"货品数量",prop:"number"}},[o("el-input",{model:{value:t.productForm.number,callback:function(e){t.$set(t.productForm,"number",e)},expression:"productForm.number"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"SKU编码",prop:"skuNo"}},[o("el-input",{model:{value:t.productForm.skuNo,callback:function(e){t.$set(t.productForm,"skuNo",e)},expression:"productForm.skuNo"}})],1),t._v(" "),o("el-form-item",{staticStyle:{width:"500px"},attrs:{label:"货品图片",prop:"url"}},[o("el-upload",{staticClass:"avatar-uploader",attrs:{action:t.uploadPath,"list-type":"picture-card","show-file-list":!1,accept:".jpg,.jpeg,.png,.gif","on-success":t.uploadProductUrl}},[t.productForm.url?o("img",{staticClass:"avatar",attrs:{src:t.productForm.url}}):o("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),t._v(" "),o("span",{staticClass:"pic-notice"},[t._v("建议上传375px*375px尺寸图片，货品图片最多上传1张")])],1)],1),t._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(e){t.productVisiable=!1}}},[t._v("取消")]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:t.handleProductEdit}},[t._v("确定")])],1)],1)],1)],1)},staticRenderFns:[]};var l=o("VU/8")(n,a,!1,function(t){o("fgCa")},"data-v-3c413e24",null);e.default=l.exports},wG0u:function(t,e,o){var i=o("ddzh");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);o("rjj0")("f94dc1a6",i,!0)}});