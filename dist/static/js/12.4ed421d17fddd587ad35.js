webpackJsonp([12,26],{"/4B1":function(t,e,a){(t.exports=a("FZ+f")(!1)).push([t.i,"\n.action-btn-width[data-v-0de5a8b9]{\r\n  width: 70px;\n}\r\n",""])},"1Tkg":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("mvHQ"),n=a.n(i),o=a("4cjj"),l=a("s8Ph"),r=a("/Zk0"),s={name:"CouponAdd",props:{dialogStatus:String},components:{BaseUploadSingle:r.a},data:function(){return{downloadPath:"",token:"",dialogFormVisible:!1,goodstype:[],coupontype:"",goodsno:"",dataForm:{id:void 0,name:"",imgUrl:"",type:void 0,conditionValue:"",valueId:"",value:"",num:"",startTime:this.changeTime((new Date).getTime()),endTime:this.changeTime((new Date).getTime())},textMap:{update:"编辑",create:"添加优惠券"},rules:{startTime:[{required:!0,message:"开始日期不能为空",trigger:"change"}],endTime:[{required:!0,message:"结束日期不能为空",trigger:"change"}],name:[{required:!0,message:"优惠券名称不能为空",trigger:"blur"}],type:[{required:!0,message:"商品类型不能为空",trigger:"blur"}],conditionValue:[{required:!0,message:"满减规则不能为空",trigger:"blur"}],value:[{required:!0,message:"满减规则不能为空",trigger:"change"}],num:[{required:!0,message:"发放数量不能为空",trigger:"blur"}]}}},created:function(){this.getlistCategory()},mounted:function(){},methods:{init:function(t){var e=this;this.dialogFormVisible=!0,this.$nextTick(function(){e.initFormData(t),e.$refs.dataForm.clearValidate()})},initFormData:function(t){t?(this.dataForm=this.changeFormData(t),this.$forceUpdate()):(this.$refs.dataForm.resetFields(),this.coupontype="",this.dataForm.conditionValue="",this.goodsno=""),this.$refs.dataForm.clearValidate()},changeFormData:function(t){var e=JSON.parse(n()(t));return 1===e.type&&(this.coupontype="all"),2===e.type&&(this.coupontype=e.valueId),3===e.type&&(this.coupontype="one",this.goodsno=e.valueId),e},getlistCategory:function(){var t=this;Object(l.c)().then(function(e){var a=e.data;t.goodstype=a.data})},getToken:function(t,e){this.token=t,this.downloadPath=e},add0:function(t){return t<10?"0"+t:t},changeTime:function(t){var e=new Date(t),a=e.getFullYear(),i=e.getMonth()+1,n=e.getDate();return a+"-"+this.add0(i)+"-"+this.add0(n)+" 00:00:00"},postCouponAdd:function(t){var e=this;Object(o.a)(t).then(function(t){0===t.data.code&&(e.dialogFormVisible=!1,e.$parent.getList())})},putCouponUpdate:function(t){var e=this;Object(o.c)(t).then(function(t){0===t.data.code&&(e.dialogFormVisible=!1,e.$parent.getList())})},createData:function(t){this.formValidate(t)},updateData:function(t){this.formValidate(t)},formValidate:function(t){var e=this;if("all"===this.coupontype)this.dataForm.type=1,this.dataForm.valueId=null;else if("one"===this.coupontype){if(this.dataForm.type=3,this.dataForm.valueId=this.goodsno,""===this.goodsno||null===this.goodsno)return void this.$message.error("商品Id不能为空")}else""!==this.coupontype&&(this.dataForm.type=2,this.dataForm.valueId=this.coupontype);this.$refs.dataForm.validate(function(a){if(!a)return console.log("error submit!!"),!1;var i=e.dataForm;return Number(i.conditionValue)<=Number(i.value)?(e.$message.error("满减不能小于优惠价格"),e.dataForm.conditionValue="",e.dataForm.value="",void e.$refs.dataForm.validateField("value")):new Date(Date.parse(e.dataForm.startTime))>new Date(Date.parse(e.dataForm.endTime))?(e.$message.error("开始时间不能大于结束时间"),e.$refs.dataForm.clearValidate("startTime"),void e.$refs.dataForm.clearValidate("endTime")):("update"===t&&e.putCouponUpdate(i),void("create"===t&&e.postCouponAdd(i)))})},uploadUrl:function(t){this.dataForm.imgUrl=t}}},d={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogFormVisible,width:"1000px"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-form",{ref:"dataForm",staticClass:"demo-ruleForm",staticStyle:{"margin-left":"50px"},attrs:{rules:t.rules,model:t.dataForm,"status-icon":"","label-position":"left","label-width":"100px"}},[a("el-form-item",{staticStyle:{width:"400px"},attrs:{label:"优惠券名称",prop:"name"}},[a("el-input",{model:{value:t.dataForm.name,callback:function(e){t.$set(t.dataForm,"name",e)},expression:"dataForm.name"}})],1),t._v(" "),a("el-form-item",{staticStyle:{width:"400px"},attrs:{label:"商品类型",prop:"type"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.coupontype,callback:function(e){t.coupontype=e},expression:"coupontype"}},[a("el-option",{attrs:{label:"全部商品",value:"all"}}),t._v(" "),t._l(t.goodstype,function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.value}})}),t._v(" "),a("el-option",{attrs:{label:"单品",value:"one"}})],2)],1),t._v(" "),"one"===t.coupontype?a("el-form-item",{staticStyle:{width:"400px"},attrs:{label:"商品Id",rules:{required:!0,message:"商品Id不能为空",trigger:"blur"}}},[a("el-input",{model:{value:t.goodsno,callback:function(e){t.goodsno=e},expression:"goodsno"}})],1):t._e(),t._v(" "),a("el-form-item",{staticStyle:{width:"400px"},attrs:{label:"开始日期",prop:"startTime"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.dataForm.startTime,callback:function(e){t.$set(t.dataForm,"startTime",e)},expression:"dataForm.startTime"}})],1),t._v(" "),a("el-form-item",{staticStyle:{width:"400px"},attrs:{label:"结束日期",prop:"endTime"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.dataForm.endTime,callback:function(e){t.$set(t.dataForm,"endTime",e)},expression:"dataForm.endTime"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"优惠券图片",prop:"imgUrl"}},[a("base-upload-single",{attrs:{url:t.dataForm.imgUrl},on:{onSuccess:t.uploadUrl,getToken:t.getToken}}),t._v(" "),a("span",{staticClass:"pic-notice"},[a("div",[t._v("建议上传303*96尺寸图片")])])],1),t._v(" "),a("el-form-item",{staticStyle:{width:"400px"},attrs:{label:"发放数量",prop:"num"}},[a("el-input",{staticClass:"input_inline",model:{value:t.dataForm.num,callback:function(e){t.$set(t.dataForm,"num",e)},expression:"dataForm.num"}}),a("span",[t._v("张")])],1),t._v(" "),a("el-form-item",{attrs:{label:"减免规则",prop:"value"}},[a("span",[t._v("购物满")]),a("el-input",{staticClass:"input_inline",attrs:{type:"number",min:"0"},model:{value:t.dataForm.conditionValue,callback:function(e){t.$set(t.dataForm,"conditionValue",e)},expression:"dataForm.conditionValue"}}),a("span",[t._v("元 ")]),a("span",[t._v("减免")]),a("el-input",{staticClass:"input_inline",attrs:{type:"number",min:"0"},model:{value:t.dataForm.value,callback:function(e){t.$set(t.dataForm,"value",e)},expression:"dataForm.value"}}),a("span",[t._v("元")])],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取消")]),t._v(" "),"create"==t.dialogStatus?a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.createData("create")}}},[t._v("确定")]):a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.updateData("update")}}},[t._v("确定")])],1)],1)},staticRenderFns:[]};var c=a("VU/8")(s,d,!1,function(t){a("7NBC")},"data-v-cd77bc60",null);e.default=c.exports},"4cjj":function(t,e,a){"use strict";e.d=function(t){return Object(i.a)({url:"/activity/activity/coupon/admin/getList",method:"get",params:t})},e.a=function(t){return Object(i.a)({url:"/activity/activity/coupon/admin/add",method:"POST",data:t})},e.c=function(t){return Object(i.a)({url:"/activity/activity/coupon/admin/update",method:"PUT",data:t})},e.b=function(t){return Object(i.a)({url:"/activity/activity/coupon/admin/delete/"+t,method:"PUT"})};var i=a("vLgD")},"7NBC":function(t,e,a){var i=a("HSgN");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("rjj0")("169c8f0c",i,!0)},HSgN:function(t,e,a){(t.exports=a("FZ+f")(!1)).push([t.i,"\n.input_inline[data-v-cd77bc60]{\n  display: inline-block;\n  width: 120px;\n  margin: 0 10px;\n}\n",""])},X1YL:function(t,e,a){var i=a("/4B1");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("rjj0")("56676cb4",i,!0)},Xzy5:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("Dd8w"),n=a.n(i),o=a("NYxO"),l=a("s8Ph"),r=a("4cjj"),s=a("0xDb"),d=a("Pcuu"),c={name:"coupon",components:{CouponAdd:a("1Tkg").default,ActionPermControl:d.a},computed:n()({},Object(o.b)(["id","name"])),data:function(){return{list:void 0,total:void 0,listLoading:!0,listQuery:{id:"",name:"",page:1,limit:20},dateTime:void 0,dialogFormVisible:!1,dialogVisible:!1,dialogStatus:"",textMap:"",downloadLoading:!1,motorList:[],props:{value:"id",label:"name",children:"children"},editDatas:{},couponStatus:["","未开始","进行中","已过期"],goodstype:[]}},created:function(){var t=this;Object(l.c)().then(function(e){var a=e.data;t.goodstype=a.data}),this.getList()},methods:{getList:function(){var t=this;Object(r.d)(this.listQuery).then(function(e){var a=e.data.data;t.list=a.items,t.total=a.total,t.listLoading=!1}).catch(function(){t.list=[],t.total=0,t.listLoading=!1})},filterType:function(t,e){return 1===t.type?"全部商品":2===t.type?t.valueName:3===t.type?"单品":void 0},filterTypeVula:function(t,e){if(3===t.type)return t.valueId},handleFilter:function(){this.listQuery.page=1,this.listQuery=Object(s.a)(this.listQuery),this.getList()},handleSizeChange:function(t){this.listQuery.limit=t,this.getList()},handleCurrentChange:function(t){this.listQuery.page=t,this.getList()},handleDetail:function(t){var e=this;this.dialogVisible=!0,this.$nextTick(function(){e.$refs.CouponDetail.init()})},handleEdit:function(t){var e=this;this.dialogFormVisible=!0,this.textMap="update",this.$nextTick(function(){e.$refs.CouponAdd.init(t)})},handleDelete:function(t){var e=this;this.$confirm("此操作将永久删除该优惠券, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(r.b)(t.id).then(function(t){0===t.data.code?(e.$message({type:"success",message:"删除成功!"}),e.getList()):e.$message({type:"error",message:t.data.msg})})})},handleAdd:function(){var t=this;this.dialogFormVisible=!0,this.textMap="create",this.$nextTick(function(){t.$refs.CouponAdd.init()})}}},u={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container calendar-list-container"},[a("div",{staticClass:"filter-container"},[a("el-form",{attrs:{inline:!0,"label-position":"right"}},[a("el-form-item",{staticClass:"no-margin-bottom",attrs:{label:"优惠券ID"}},[a("el-input",{staticClass:"filter-item",staticStyle:{width:"220px"},attrs:{clearable:"",placeholder:"请输入"},model:{value:t.listQuery.id,callback:function(e){t.$set(t.listQuery,"id",e)},expression:"listQuery.id"}})],1),t._v(" "),a("el-form-item",{staticClass:"no-margin-bottom",attrs:{label:"优惠券名称"}},[a("el-input",{staticClass:"filter-item",staticStyle:{width:"220px"},attrs:{clearable:"",placeholder:"请输入"},model:{value:t.listQuery.name,callback:function(e){t.$set(t.listQuery,"name",e)},expression:"listQuery.name"}})],1),t._v(" "),a("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.handleFilter}},[t._v("查找")]),t._v(" "),t.$checkPerm("create")?a("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-plus",loading:t.downloadLoading},on:{click:t.handleAdd}},[t._v("添加")]):t._e()],1)],1),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],attrs:{size:"small",data:t.list,"element-loading-text":"正在查询中。。。",border:"",fit:"","highlight-current-row":""}},[a("el-table-column",{attrs:{align:"center",width:"80",label:"优惠券ID",prop:"id"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"优惠券名称",prop:"name"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"优惠券图标",prop:"imgUrl"},scopedSlots:t._u([{key:"default",fn:function(t){return t.row.imgUrl?[a("img",{staticStyle:{width:"100%",height:"auto"},attrs:{src:t.row.imgUrl}})]:void 0}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"商品类型",prop:"type",formatter:t.filterType}}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"商品Id",prop:"type",formatter:t.filterTypeVula}}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"开始时间",prop:"startTime"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"结束时间",prop:"endTime"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",width:"80",label:"状态",prop:"status"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(t.couponStatus[e.row.status])+"\n      ")]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"发放数量",prop:"num"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"领取数量",prop:"getNum"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"使用数量",prop:"usedNum"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"操作",width:"200","class-name":"small-padding fixed-width"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("action-perm-control",{attrs:{hasPerm:t.$checkPerm("update","delete")}},[t.$checkPerm("delete")?a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){t.handleDelete(e.row)}}},[t._v("删除")]):t._e()],1)]}}])})],1),t._v(" "),a("div",{staticClass:"pagination-container"},[a("el-pagination",{attrs:{background:"","current-page":t.listQuery.page,"page-sizes":[10,20,30,50],"page-size":t.listQuery.limit,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),t._v(" "),t.dialogFormVisible?a("coupon-add",{ref:"CouponAdd",attrs:{dialogStatus:t.textMap}}):t._e()],1)},staticRenderFns:[]};var m=a("VU/8")(c,u,!1,function(t){a("X1YL")},"data-v-0de5a8b9",null);e.default=m.exports}});