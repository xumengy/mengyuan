webpackJsonp([50],{fefS:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("Gu7T"),r=i.n(n),s=i("zL8q"),a=i("STSY"),c={name:"Permission",data:function(){return{id:void 0,roleName:"",permissionData:[],checkedData:[],defaultProps:{children:"children",label:"name"},checkChildren:[]}},created:function(){this.$route.query.id||this.$route.query.name?(this.id=this.$route.query.id,this.roleName=this.$route.query.name,this.getListRolePerm()):this.banVisit()},methods:{banVisit:function(){var e=this;s.MessageBox.alert("未提供角色信息","禁止访问",{confirmButtonText:"确定",type:"error"}).finally(function(){e.$router.push({path:"/sys/role"})})},getListRolePerm:function(e){var t=this;Object(a.c)({roleId:this.id||e}).then(function(e){t.permissionData=e.data.data.trees,t.checkedData=e.data.data.permissionIds})},updatePerm:function(){var e=this,t=this.$refs.permTree;Object(a.f)(this.id,{permissionIds:t.getCheckedKeys()}).then(function(t){e.$notify({title:"成功",message:"更新权限成功",type:"success",duration:2e3})}).catch(function(t){console.log(t),e.$notify({title:"失败",message:t.data?t.data.msg:"更新权限失败",type:"error",duration:2e3})}).finally(function(){e.getListRolePerm()})},handleCheck:function(e,t){var i=this.$refs.permTree;if(t.checkedKeys.indexOf(e.id)>-1){this.getChlidrenKeys(e,1),this.checkChildren.length>0&&i.setCheckedKeys([].concat(r()(this.checkChildren),r()(i.getCheckedKeys())));var n=this.getParentKeys(e);this.setMutCheckedKeys(n,!0)}else this.getChlidrenKeys(e,1),this.checkChildren.length>0&&this.setMutCheckedKeys(this.checkChildren,!1)},getChlidrenKeys:function(e,t){var i=this;this.checkChildren=1===t?[]:[].concat(r()(this.checkChildren),[e.id]),e.children&&e.children.length>0&&e.children.map(function(e){i.getChlidrenKeys(e)})},getParentKeys:function(e){var t=Number(e.istype);if(0===t)return[];if(1===t)return[e.pid];if(2===t){var i=[];return i.push(e.pid),i.push(this.getParentKeyByTraver(e.pid)),i}},getParentKeyByTraver:function(e){var t="";return this.permissionData.map(function(i){i.children&&i.children.map(function(n){n.id===e&&(t=i.id)})}),t},setMutCheckedKeys:function(e,t){var i=this.$refs.permTree;e.length>0&&e.map(function(e){i.setChecked(e,t)})}}},h={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container calendar-list-container"},[i("el-card",[i("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[i("span",[e._v("\n        正在为角色\n        "),i("el-tag",{attrs:{size:"small"}},[e._v(e._s(e.roleName))]),e._v("\n        分配权限\n      ")],1)]),e._v(" "),i("div",[i("el-tree",{ref:"permTree",attrs:{data:e.permissionData,"show-checkbox":"","node-key":"id","default-checked-keys":e.checkedData,"check-on-click-node":!1,props:e.defaultProps,"check-strictly":"","default-expand-all":""},on:{check:e.handleCheck}}),e._v(" "),i("el-button",{staticClass:"update-perm-btn",attrs:{type:"primary",size:"mini"},on:{click:e.updatePerm}},[e._v("更新权限")])],1)])],1)},staticRenderFns:[]};var d=i("VU/8")(c,h,!1,function(e){i("hUM5")},"data-v-086dbb62",null);t.default=d.exports},hUM5:function(e,t,i){var n=i("vUa7");"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);i("rjj0")("5cd0d59d",n,!0)},vUa7:function(e,t,i){(e.exports=i("FZ+f")(!1)).push([e.i,"\n.update-perm-btn[data-v-086dbb62]{\r\n  margin-top: 20px;\r\n  margin-left: 10px;\n}\r\n",""])}});